# Банковское приложение

## Описание

Это пример банковского приложения, разработанного в рамках тестового задания. Приложение предоставляет базовый функционал для управления клиентами, банковскими счетами, транзакциями и аутентификацией с использованием JSON Web Tokens (JWT).

## Основные функции

- **Пользователи**: В системе есть пользователи (клиенты), у каждого клиента есть строго один банковский аккаунт с начальным балансом. Пользователи могут добавлять и менять свои контактные данные (телефон и email), если они не заняты другими пользователями. Удаление всех контактных данных недопустимо.
- **Банковские счета**: Баланс банковского счета не может уходить в минус. Баланс обновляется раз в минуту, увеличиваясь на 5%, но не более 207% от начального депозита.
- **Транзакции**: Пользователи могут переводить деньги со своего счета на счета других пользователей. Все необходимые валидации и потокобезопасность должны быть обеспечены.
- **Поиск пользователей**: Реализовано API для поиска пользователей с фильтрацией по дате рождения, телефону, ФИО и email. Поддерживается пагинация и сортировка.
- **Аутентификация и авторизация**: Доступ к API осуществляется с помощью JWT. Аутентифицированные пользователи могут выполнять операции с банковскими счетами и транзакциями.

## Стек технологий

- **Java 17**
- **Spring Boot 3**
- **PostgreSQL**
- **Maven**
- **REST API**
- **JWT** для аутентификации
- **OpenAPI/Swagger** для документирования API

## Установка

1. Клонируйте репозиторий: `git clone https://github.com/yourusername/banking-application.git`
2. Перейдите в директорию проекта: `cd banking-application`
3. Обновить файл application.properties с настройками базы данных
4. Соберите проект: `mvn clean install`
5. Запустите приложение: `mvn spring-boot:run`

Убедитесь, что у вас установлены Maven и JDK.

## Использование

1. После запуска приложения, доступ к Swagger UI осуществляется по адресу `http://localhost:8080/swagger-ui.html`.
2. Используйте Swagger UI для тестирования различных API эндпоинтов для управления клиентами, операциями с банковскими счетами и транзакциями.
3. Для аутентификации используйте эндпоинт `/api/clients/authenticate` для получения JWT токена. Включите этот токен в заголовок `Authorization` с значением `Bearer <token>` для последующих запросов.

## Конфигурация

- **Конфигурация базы данных**: По умолчанию приложение использует базу данных PostgreSQL. Вы можете изменить настройки базы данных в файле `application.properties`.
- **Конфигурация безопасности**: Секретный ключ JWT и время действия токена можно настроить в файле `application.properties`.
- **Конфигурация логирования**: Уровни логирования и аппендеры можно настроить в файле `logback.xml`.

## Логирование

Приложение ведет логирование ключевых операций и ошибок, что позволяет отслеживать выполнение бизнес-логики и быстро находить проблемы.

## Тестирование

Приложение содержит тесты для покрытия функционала перевода денег. Запуск тестов осуществляется командой:

```sh
mvn test
```

## API эндпоинты
### 1. Аутентификация и авторизация

Запрос на аутентификацию

&nbsp;**URL:** `POST /authenticate`

>**Пример запроса:**

```json
{
  "username": "testUser",
  "password": "testPassword"
}
```

>**Пример ответа:**

```json
{
  "message": "Authentication successful!. Access token: <token>"
}
```

### 2. Создание клиента и обновление контактной информации

Запрос на создание клиента

&nbsp;**URL:** `POST /clients`

>**Пример запроса:**

```json
{
  "username": "testUser",
  "password": "testPassword",
  "phoneNumber": "1234567890",
  "email": "test@example.com",
  "initialBalance": 100.00,
  "birthDate": "1990-01-01",
  "fullName": "John Doe"
}
```

>**Пример ответа:**

```json
{
  "id": 1,
  "username": "testUser",
  "phoneNumber": "1234567890",
  "email": "test@example.com",
  "initialBalance": 100.00,
  "birthDate": "1990-01-01",
  "fullName": "John Doe",
  "createdAt": "2023-01-01T00:00:00"
}
```

**Запрос на обновление контактной информации клиента**

&nbsp;**URL:** `PUT /clients/{clientId}/contact-info`

>**Пример запроса:**

```json
{
  "phoneNumber": "0987654321",
  "email": "new@example.com"
}
```

>**Пример ответа:**

```json
{
  "id": 1,
  "username": "testUser",
  "phoneNumber": "0987654321",
  "email": "new@example.com",
  "initialBalance": 100.00,
  "birthDate": "1990-01-01",
  "fullName": "John Doe",
  "updatedAt": "2023-01-02T00:00:00"
}
```

### 3. Перевод денег

**Запрос на перевод денег**

&nbsp;**URL:** `POST /transactions/transfer`

>**Пример запроса:**

```json
{
  "fromClientId": 1,
  "toClientId": 2,
  "amount": 50.00
}
```

>**Пример ответа:**

```json
{
  "message": "Transaction successful! Transaction ID: 12345"
}
```

### 4. Начисление процентов на баланс

**Запрос на начисление процентов (Этот процесс обычно запускается по расписанию, но для тестирования можно сделать ручной запуск)**

&nbsp;**URL:** `POST /accounts/apply-interest`

>**Пример запроса:**

```json
{
  "manual": true
}
```

>**Пример ответа:**

```json
{
  "message": "Interest applied to all accounts"
}
```

### 5. Поиск клиентов

**Запрос на поиск клиентов**

&nbsp;**URL:** `GET /clients/search`

>**Пример запроса:**

```json
{
  "birthDate": "1985-01-01",
  "phoneNumber": "1234567890",
  "fullName": "John",
  "email": "john@example.com",
  "page": 0,
  "size": 10,
  "sort": "fullName,asc"
}
```

>**Пример ответа:**

```json
{
  "content": [
    {
      "id": 1,
      "username": "johnDoe",
      "phoneNumber": "1234567890",
      "email": "john@example.com",
      "initialBalance": 200.00,
      "birthDate": "1985-01-01",
      "fullName": "John Doe",
      "createdAt": "2023-01-01T00:00:00"
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10,
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    }
  },
  "totalPages": 1,
  "totalElements": 1,
  "last": true,
  "size": 10,
  "number": 0,
  "sort": {
    "sorted": true,
    "unsorted": false,
    "empty": false
  },
  "first": true,
  "numberOfElements": 1,
  "empty": false
}
```

Эти примеры JSON запросов помогут вам протестировать функционал приложения.
